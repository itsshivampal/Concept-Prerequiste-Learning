The sum-product algorithm that we derive in the next section is applicable to
undirected and directed trees and to polytrees. It can be cast in a particularly simple
and general form if we first introduce a new graphical construction called a factor
graph (Frey, 1998; Kschischnang et al., 2001).
Both directed and undirected graphs allow a global function of several vari-
ables to be expressed as a product of factors over subsets of those variables. Factor
graphs make this decomposition explicit by introducing additional nodes for the fac-
tors themselves in addition to the nodes representing the variables. They also allow
us to be more explicit about the details of the factorization, as we shall see.
Let us write the joint distribution over a set of variables in the form of a product
of factors
where xs denotes a subset of the variables. For convenience, we shall denote the
p(x) =
fs(xs)
s
(8.59)
400
8. GRAPHICAL MODELS
Figure 8.40 Example of a factor graph, which corresponds
to the factorization (8.60).
x1
x2
x3
fa
fb
fc
fd
individual variables by xi, however, as in earlier discussions, these can comprise
groups of variables (such as vectors or matrices). Each factor fs is a function of a
corresponding set of variables xs.
Directed graphs, whose factorization is defined by (8.5), represent special cases
of (8.59) in which the factors fs(xs) are local conditional distributions. Similarly,
undirected graphs, given by (8.39), are a special case in which the factors are po-
tential functions over the maximal cliques (the normalizing coefficient 1/Z can be
viewed as a factor defined over the empty set of variables).
In a factor graph, there is a node (depicted as usual by a circle) for every variable
in the distribution, as was the case for directed and undirected graphs. There are also
additional nodes (depicted by small squares) for each factor fs(xs) in the joint dis-
tribution. Finally, there are undirected links connecting each factor node to all of the
variables nodes on which that factor depends. Consider, for example, a distribution
that is expressed in terms of the factorization
p(x) = fa(x1, x2)fb(x1, x2)fc(x2, x3)fd(x3).
(8.60)
This can be expressed by the factor graph shown in Figure 8.40. Note that there are
two factors fa(x1, x2) and fb(x1, x2) that are defined over the same set of variables.
In an undirected graph, the product of two such factors would simply be lumped
together into the same clique potential. Similarly, fc(x2, x3) and fd(x3) could be
combined into a single potential over x2 and x3. The factor graph, however, keeps
such factors explicit and so is able to convey more detailed information about the
underlying factorization.
x1
x2
x1
x2
x1
f
x3
(b)
x3
(a)
x2
fb
fa
x3
(c)
Figure 8.41 (a) An undirected graph with a single clique potential ψ(x1, x2, x3). (b) A factor graph with factor
f (x1, x2, x3) = ψ(x1, x2, x3) representing the same distribution as the undirected graph. (c) A different factor
graph representing the same distribution, whose factors satisfy fa(x1, x2, x3)fb(x1, x2) = ψ(x1, x2, x3).
x1
x2
x1
x2
x1
x2
8.4. Inference in Graphical Models
401
f
x3
(b)
fc
fa
fb
x3
(c)
x3
(a)
Figure 8.42 (a) A directed graph with the factorization p(x1)p(x2)p(x3|x1, x2). (b) A factor graph representing
the same distribution as the directed graph, whose factor satisfies f (x1, x2, x3) = p(x1)p(x2)p(x3|x1, x2). (c)
A different factor graph representing the same distribution with factors fa(x1) = p(x1), fb(x2) = p(x2) and
fc(x1, x2, x3) = p(x3|x1, x2).
Factor graphs are said to be bipartite because they consist of two distinct kinds
of nodes, and all links go between nodes of opposite type. In general, factor graphs
can therefore always be drawn as two rows of nodes (variable nodes at the top and
factor nodes at the bottom) with links between the rows, as shown in the example in
Figure 8.40. In some situations, however, other ways of laying out the graph may
be more intuitive, for example when the factor graph is derived from a directed or
undirected graph, as we shall see.
If we are given a distribution that is expressed in terms of an undirected graph,
then we can readily convert it to a factor graph. To do this, we create variable nodes
corresponding to the nodes in the original undirected graph, and then create addi-
tional factor nodes corresponding to the maximal cliques xs. The factors fs(xs) are
then set equal to the clique potentials. Note that there may be several different factor
graphs that correspond to the same undirected graph. These concepts are illustrated
in Figure 8.41.
Similarly, to convert a directed graph to a factor graph, we simply create variable
nodes in the factor graph corresponding to the nodes of the directed graph, and then
create factor nodes corresponding to the conditional distributions, and then finally
add the appropriate links. Again, there can be multiple factor graphs all of which
correspond to the same directed graph. The conversion of a directed graph to a
factor graph is illustrated in Figure 8.42.
We have already noted the importance of tree-structured graphs for performing
efficient inference. If we take a directed or undirected tree and convert it into a factor
graph, then the result will again be a tree (in other words, the factor graph will have
no loops, and there will be one and only one path connecting any two nodes). In
the case of a directed polytree, conversion to an undirected graph results in loops
due to the moralization step, whereas conversion to a factor graph again results in a
tree, as illustrated in Figure 8.43.
In fact, local cycles in a directed graph due to
links connecting parents of a node can be removed on conversion to a factor graph
by defining the appropriate factor function, as shown in Figure 8.44.
We have seen that multiple different factor graphs can represent the same di-
rected or undirected graph. This allows factor graphs to be more specific about the
402
8. GRAPHICAL MODELS
(a)
(b)
(c)
Figure 8.43 (a) A directed polytree. (b) The result of converting the polytree into an undirected graph showing
the creation of loops. (c) The result of converting the polytree into a factor graph, which retains the tree structure.
precise form of the factorization. Figure 8.45 shows an example of a fully connected
undirected graph along with two different factor graphs.
In (b), the joint distri-
bution is given by a general form p(x) = f(x1, x2, x3), whereas in (c), it is given
by the more specific factorization p(x) = fa(x1, x2)fb(x1, x3)fc(x2, x3). It should
be emphasized that the factorization in (c) does not correspond to any conditional
independence properties.
